const hostname={host:require("os").hostname()},crypto=require("crypto");LogId=function(){return((+Date.now()).toString(16)+crypto.prng(6).toString("hex")).toUpperCase()},Error.stackTraceLimit=10;const defaultLevel="debug",debug=!0;var parseStack=function(a,b=0){for(var c=/at ([\.a-zA-Z0-9\[\]\<\>]*).*(?:[\/\\](?:([a-z0-9\-._]*)\:([0-9]*)\:))/g,d=0;d<b;d++)c.exec(a);try{let[b,d,e,f]=c.exec(a);return{file:e,caller:d.split(".").pop(),line:f}}catch(b){return{file:"Unknown",caller:"Anonymous function, need to give this function a name",line:"Unknown",stack:a}}};function paddLeft(a,b,c){return(c.repeat(b)+a).slice(-1*b)}const LogMessageTransformer=function(a,b){var c,d=[];switch(!0){case"string"==typeof a:c=a;break;case"boolean"==typeof a:c=LogId();break;default:c=void 0;}let e=[process.env.sn||"system",paddLeft(process.env.swid||"",2,"0")||"00"].filter(function(a){return a}).join("#");var f=function a(f,g){var h={ts:Date.now(),pids:e,cc:c};switch(!0){case f instanceof Error:h.meta=[f.stack],h.msg=f.message,h.level="error";break;case g instanceof Error:h.meta=[g.stack];case"object"==typeof g:h.src=g.src,h.msg=g.message,h.level=b[f]?f:"debug";break;case!g:h.msg=f,h.level="debug";break;default:h.msg=g,h.level=b[f]?f:"debug";}return h.meta=(h.meta||[]).concat(d),d=[],!h.src&&(Error.captureStackTrace(h,a.caller),h.src=parseStack(h.stack)),Object.assign(h,hostname),h};return Object.defineProperties(f,{meta:{get:function(){return d},set:function(a){a&&d.push(a)}},id:{value:c},timeStamp:{value:function a(b,c,d=0){let e={ts:process.hrtime(b)};return Error.captureStackTrace(e,a.caller),e.src=parseStack(e.stack,d),c&&(f.meta={origin:`${c.src.file}:${c.src.line} | ${c.src.caller}`}),e}}}),f},_colors={WHITE:"\x1B[1;40;37m",RESET:"\x1B[0m",DEFAULT:"\x1B[0m\x1B[1m",GRAY:"\x1B[0;40;37m",DARK_GRAY:"\x1B[1;40;30m",RED:"\x1B[1;40;31m",DARK_RED:"\x1B[0;40;31m",GREEN:"\x1B[1;40;32m",DARK_GREEN:"\x1B[0;40;32m",BLUE:"\x1B[1;40;34m",PURPLE:"\x1B[1;40;35m",TURQUOISE:"\x1B[1;40;36m",DARK_TURQUOISE:"\x1B[0;40;36m",YELLOW:"\x1B[1;40;33m",DARK_YELLOW:"\x1B[0;40;33m",WHITE_ON_RED:"\x1B[1;41;37m",TURQUOISE_ON_RED:"\x1B[1;41;36m",YELLOW_ON_RED:"\x1B[1;41;33m",GREEN_ON_RED:"\x1B[1;41;32m",YELLOW_ON_GREEN:"\x1B[1;42;33m",WHITE_ON_GREEN:"\x1B[1;42;37m",YELLOW_ON_YELLOW:"\x1B[1;43;33m",GREEN_ON_YELLOW:"\x1B[1;43;32m",BLUE_ON_YELLOW:"\x1B[1;43;34m",WHITE_ON_BLUE:"\x1B[1;44;37m",GRAY_ON_BLUE:"\x1B[1;44;30m",RED_ON_BLUE:"\x1B[1;44;31m",GREEN_ON_BLUE:"\x1B[1;44;32m",YELLOW_ON_BLUE:"\x1B[1;44;33m",PURPLE_ON_BLUE:"\x1B[1;44;35m",WHITE_ON_PURPLE:"\x1B[1;45;37m",YELLOW_ON_PURPLE:"\x1B[1;45;33m",GREEN_ON_PURPLE:"\x1B[1;45;32m",TURQUOISE_ON_PURPLE:"\x1B[1;45;36m",BLACK_ON_TURQUOISE:"\x1B[0;46;30m",GREEN_ON_TURQUOISE:"\x1B[1;46;32m",YELLOW_ON_TURQUOISE:"\x1B[1;46;33m",GRAY_ON_TURQUOISE:"\x1B[0;46;37m",WHITE_ON_TURQUOISE:"\x1B[1;46;37m",BLACK_ON_GRAY:"\x1B[0;47;30m",RED_ON_GRAY:"\x1B[1;47;31m",DARK_RED_ON_GRAY:"\x1B[0;47;31m",DARK_GREEN_ON_GRAY:"\x1B[0;47;32m",YELLOW_ON_GRAY:"\x1B[1;47;33m",BLUE_ON_GRAY:"\x1B[1;47;34m",DARK_BLUE_ON_GRAY:"\x1B[0;47;34m",PURPLE_ON_GRAY:"\x1B[1;47;35m",DARK_PURPLE_ON_GRAY:"\x1B[0;47;35m",DARK_TURQUOISE_ON_GRAY:"\x1B[0;47;36m"},color=function(a,b){return b=b||"DEFAULT",`${_colors[b.toUpperCase()]}${a}${_colors.RESET}`},levels={alert:{level:0,messageColor:"RED",labelColor:"WHITE_ON_RED",srcColor:"WHITE_ON_RED",metaColor:"YELLOW"},error:{level:1,messageColor:"WHITE",labelColor:"RED",srcColor:"WHITE_ON_RED",metaColor:"RED"},warning:{level:2,messageColor:"WHITE",labelColor:"YELLOW",metaColor:"GRAY",srcColor:"YELLOW_ON_YELLOW"},info:{level:3,messageColor:"WHITE",labelColor:"GREEN",srcColor:"WHITE_ON_BLUE",metaColor:"GRAY"},time:{level:3,messageColor:"PURPLE",labelColor:"WHITE_ON_PURPLE",srcColor:"WHITE_ON_PURPLE",metaColor:"GRAY"},debug:{level:4,messageColor:"WHITE",labelColor:"PURPLE",srcColor:"WHITE_ON_BLUE",metaColor:"GRAY"},todo:{level:4,messageColor:"WHITE",labelColor:"WHITE_ON_GREEN",srcColor:"WHITE_ON_BLUE",metaColor:"GRAY"},deprecated:{level:4,messageColor:"WHITE",labelColor:"YELLOW_ON_YELLOW",srcColor:"WHITE_ON_BLUE",metaColor:"GRAY"}};function paddRight(a,b,c){return(a+c.repeat(b)).substring(0,b)}function paddLeft(a,b,c){return(c.repeat(b)+a).slice(-1*b)}function formatDate(a){var b=/[0-9]{2}([0-9]{2})-([0-9]{2})-([0-9]{2})T([0-9:.]{12})/.exec(new Date(a).toISOString());return`${b[1]}${b[2]}${b[3]} ${b[4]}`}const idColW=40;function fromCamelCase(a){return a.replace(/[A-Z]+/g,function(a){return` ${a.toLowerCase()}`}).trim()}function writeToConsole(a,b){var c=color(paddRight(a.level,10," "),b.labelColor);c+=color(` : ${formatDate(a.ts)} | `,"WHITE"),c+=color(a.cc?`${a.cc.padEnd(24).substring(0,24)} `:`${" ".repeat(25)}`,"GREEN"),c+=color(paddLeft(a.pids+" ",15," "),"PURPLE"),a.src&&(c+=color(`| ${a.src.file}:${a.src.line} |`,"WHITE"),c+=color(" "+a.src.caller+" ",b.srcColor)),c+=color("|","WHITE"),c+=color(" "+a.msg+" ",b.messageColor),console.log(c),a.meta.forEach(function(a){c="string"==typeof a?a:JSON.stringify(a),console.log(color(`${" ".repeat(75)}| ${c}`,b.metaColor))})}const NS_PER_SEC=1e9;module.exports=function(a,b=writeToConsole,c=levels){var d=LogMessageTransformer(a,c),e=function(a,e){if(void 0!==a){var f=d(a,e);b(f,c[f.level])}};return Object.defineProperties(e,{meta:{set:function(a){d.meta=a}},id:{value:d.id},timeline:{value:{}},time:{value:function(a="main",b=0){e.timeline[a]=d.timeStamp(void 0,void 0,b)}},timeEnd:{value:function(a="main"){if(e.timeline[a]){let b=d.timeStamp(e.timeline[a].ts,e.timeline[a]),c=Math.round((1000000000*b.ts[0]+b.ts[1])/1e3)/1e3;b.message=`${a}: ${c}ms `,e("time",b)}}}}),e.time("main",1),e};